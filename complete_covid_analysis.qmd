---
title: "COVID-19 Impact on Retail Employment: An Analysis Using IPUMS CPS Data"
author: "COVID Retail Employment Analysis"
date: "`r Sys.Date()`"
format: 
  html:
    toc: true
    toc-depth: 3
    code-fold: true
    code-summary: "Show code"
    theme: cosmo
    embed-resources: true
execute:
  warning: false
  message: false
  echo: true
---

# Executive Summary

This analysis examines the impact of COVID-19 on retail employment using IPUMS Current Population Survey (CPS) data from 2020-2022. Key findings show that retail workers experienced disproportionate employment losses compared to other industries, with employment rates declining 3.7 percentage points versus 2.2 percentage points for non-retail workers. The difference-in-differences effect of -1.57 percentage points is both statistically significant (p < 0.001) and economically meaningful. All findings are validated through comprehensive statistical testing including F-tests, t-tests, ANOVA, and difference-in-differences analysis.

# Data and Methodology

## Data Source
- **Dataset**: IPUMS Current Population Survey (CPS) 2020-2022
- **Sample Size**: 1,443,532 observations (working-age population 16+)
- **Time Period**: January 2020 - December 2022
- **Industry Classification**: IND1990 codes (580-691 for retail trade)
- **COVID Variables**: COVIDTELEW (remote work) and COVIDUNAW (unable to work)

## Setup and Data Loading

```{r setup}
#| label: setup
#| include: true

library(tidyverse)
library(fixest)
library(modelsummary)
library(lubridate)
library(knitr)
library(kableExtra)

# Data path
data_path <- "C:/Users/dgaudin/OneDrive - airmethods.com/Desktop/Seattle U/5300 econometrics/Final Challenge/data_local/cps_00003.dat.gz"

cat("=== IPUMS CPS COVID RETAIL EMPLOYMENT ANALYSIS ===\n")
```

```{r data-loading}
#| label: data-loading
#| include: true

# Define column positions from IPUMS codebook
ipums_positions <- fwf_positions(
  start = c(1,   10,  116, 118, 119, 130, 137, 140, 146, 149, 152, 157, 52,  187, 189, 160, 170, 179),
  end =   c(4,   11,  117, 118, 121, 131, 139, 143, 148, 151, 153, 159, 65,  188, 190, 169, 178, 186),
  col_names = c("YEAR", "MONTH", "AGE", "SEX", "RACE", "EMPSTAT", "IND1990", "IND", 
                "UHRSWORKT", "AHRSWORKT", "WKSTAT", "EDUC", "WTFINL", 
                "COVIDTELEW", "COVIDUNAW", "FTOTVAL", "INCTOT", "INCWAGE")
)

# Load and clean data
cat("Loading IPUMS CPS data...\n")
cps_data <- read_fwf(gzfile(data_path), ipums_positions, show_col_types = FALSE) %>%
  mutate(across(everything(), as.numeric)) %>%
  filter(
    YEAR >= 2020 & YEAR <= 2022,
    MONTH >= 1 & MONTH <= 12,
    AGE >= 16,  # Working age population
    SEX %in% c(1, 2),
    EMPSTAT %in% c(10, 12, 20, 21, 22),  # Employed or unemployed (in labor force)
    !is.na(WTFINL), WTFINL > 0
  )

cat("Sample size after filtering:", nrow(cps_data), "\n")
```

```{r variable-creation}
#| label: variable-creation
#| include: true

# Create analysis variables
analysis_data <- cps_data %>%
  mutate(
    # Time variables
    date = as.Date(paste(YEAR, MONTH, "01", sep = "-")),
    post_covid = ifelse(date >= as.Date("2020-04-01"), 1, 0),
    covid_period = case_when(
      date < as.Date("2020-04-01") ~ "Pre-COVID",
      date >= as.Date("2020-04-01") & date < as.Date("2021-01-01") ~ "COVID Peak",
      date >= as.Date("2021-01-01") ~ "COVID Recovery",
      TRUE ~ "Other"
    ),
    
    # Demographics
    female = ifelse(SEX == 2, 1, 0),
    age_group = case_when(
      AGE >= 16 & AGE <= 24 ~ "16-24",
      AGE >= 25 & AGE <= 34 ~ "25-34", 
      AGE >= 35 & AGE <= 44 ~ "35-44",
      AGE >= 45 & AGE <= 54 ~ "45-54",
      AGE >= 55 & AGE <= 64 ~ "55-64",
      AGE >= 65 ~ "65+",
      TRUE ~ "Other"
    ),
    race_group = case_when(
      RACE == 100 ~ "White",
      RACE == 200 ~ "Black", 
      RACE >= 651 & RACE <= 652 ~ "Asian/PI",
      RACE >= 801 ~ "Multiracial",
      TRUE ~ "Other"
    ),
    education = case_when(
      EDUC <= 071 ~ "HS or Less",
      EDUC >= 072 & EDUC <= 092 ~ "Some College/Associates",
      EDUC >= 111 & EDUC <= 111 ~ "Bachelor's",
      EDUC >= 123 ~ "Graduate Degree",
      TRUE ~ "Other"
    ),
    
    # Employment variables
    employed = ifelse(EMPSTAT %in% c(10, 12), 1, 0),
    unemployed = ifelse(EMPSTAT %in% c(20, 21, 22), 1, 0),
    full_time = ifelse(WKSTAT %in% c(10, 11), 1, 0),
    part_time_economic = ifelse(WKSTAT %in% c(20, 21, 22), 1, 0),
    part_time_noneconomic = ifelse(WKSTAT %in% c(40, 41), 1, 0),
    
    # Industry classification (using IND1990 for consistency)
    retail_industry = ifelse(IND1990 >= 580 & IND1990 <= 691, 1, 0),
    industry_group = case_when(
      IND1990 >= 580 & IND1990 <= 691 ~ "Retail Trade",
      IND1990 >= 641 & IND1990 <= 641 ~ "Food Service",
      IND1990 >= 812 & IND1990 <= 893 ~ "Professional Services",
      IND1990 >= 100 & IND1990 <= 392 ~ "Manufacturing",
      IND1990 >= 060 & IND1990 <= 060 ~ "Construction",
      IND1990 >= 831 & IND1990 <= 840 ~ "Healthcare",
      TRUE ~ "Other Industries"
    ),
    
    # COVID-specific work impacts
    covid_remote = ifelse(COVIDTELEW == 2, 1, 0),  # Worked remotely due to COVID
    covid_unable = ifelse(COVIDUNAW == 2, 1, 0),   # Unable to work due to COVID
    covid_work_impact = ifelse(covid_remote == 1 | covid_unable == 1, 1, 0),
    
    # Hours worked
    usual_hours = ifelse(UHRSWORKT <= 996, UHRSWORKT, NA),
    actual_hours = ifelse(AHRSWORKT <= 996, AHRSWORKT, NA),
    hours_reduction = ifelse(!is.na(usual_hours) & !is.na(actual_hours), 
                             usual_hours - actual_hours, NA),
    
    # Income (available for ASEC samples only)
    has_wage_income = ifelse(!is.na(INCWAGE) & INCWAGE > 0, 1, 0),
    log_wage_income = ifelse(INCWAGE > 0, log(INCWAGE), NA)
  )
```

# Data Quality Assessment

```{r data-quality}
#| label: data-quality
#| include: true

cat("\n=== DATA QUALITY CHECK ===\n")
cat("Years:", paste(sort(unique(analysis_data$YEAR)), collapse = ", "), "\n")
cat("Months:", paste(sort(unique(analysis_data$MONTH)), collapse = ", "), "\n")
cat("Gender distribution:", round(prop.table(table(analysis_data$female)) * 100, 1), "\n")
cat("Employment status:", round(prop.table(table(analysis_data$employed)) * 100, 1), "\n")
cat("Retail workers:", sum(analysis_data$retail_industry), 
    "(", round(mean(analysis_data$retail_industry) * 100, 1), "%)\n")
```

The data quality checks confirm realistic distributions across all key variables, with proper gender balance (52.4% male, 47.6% female) and appropriate employment rates for labor force participants.

# Research Question 1: Employment Health by Industry and COVID Period

```{r employment-summary}
#| label: employment-summary
#| include: true

# Summary statistics by industry and COVID period
employment_summary <- analysis_data %>%
  group_by(industry_group, covid_period) %>%
  summarise(
    n_workers = n(),
    employment_rate = weighted.mean(employed, WTFINL, na.rm = TRUE) * 100,
    unemployment_rate = weighted.mean(unemployed, WTFINL, na.rm = TRUE) * 100,
    pct_female = weighted.mean(female, WTFINL, na.rm = TRUE) * 100,
    pct_fulltime = weighted.mean(full_time, WTFINL, na.rm = TRUE) * 100,
    covid_remote_pct = weighted.mean(covid_remote, WTFINL, na.rm = TRUE) * 100,
    covid_unable_pct = weighted.mean(covid_unable, WTFINL, na.rm = TRUE) * 100,
    avg_usual_hours = weighted.mean(usual_hours, WTFINL, na.rm = TRUE),
    avg_actual_hours = weighted.mean(actual_hours, WTFINL, na.rm = TRUE),
    .groups = "drop"
  )

employment_summary %>%
  select(industry_group, covid_period, employment_rate, unemployment_rate, covid_remote_pct, covid_unable_pct) %>%
  kable(digits = 1, 
        caption = "Employment Rates and COVID Work Impact by Industry and Period",
        col.names = c("Industry", "COVID Period", "Employment Rate (%)", 
                      "Unemployment Rate (%)", "Remote Work (%)", "Unable to Work (%)")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
```

## Key Findings - Employment Health

**Retail Trade** showed the most severe employment impacts:
- **COVID Peak**: 86.1% employment rate, 13.9% unemployment rate
- **Recovery**: 93.0% employment rate, 7.0% unemployment rate

This compares unfavorably to other major industries like **Professional Services** (93.4% → 96.9% employment) and **Manufacturing** (92.3% → 96.0% employment).

# Research Question 2: Retail vs Non-Retail Comparison

```{r retail-comparison}
#| label: retail-comparison
#| include: true

# Focus on retail vs other industries
retail_comparison <- analysis_data %>%
  group_by(retail_industry, post_covid) %>%
  summarise(
    n_workers = n(),
    employment_rate = weighted.mean(employed, WTFINL, na.rm = TRUE) * 100,
    unemployment_rate = weighted.mean(unemployed, WTFINL, na.rm = TRUE) * 100,
    covid_impact_rate = weighted.mean(covid_work_impact, WTFINL, na.rm = TRUE) * 100,
    pct_female = weighted.mean(female, WTFINL, na.rm = TRUE) * 100,
    avg_hours = weighted.mean(actual_hours, WTFINL, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    industry_type = ifelse(retail_industry == 1, "Retail", "Non-Retail"),
    period = ifelse(post_covid == 1, "Post-COVID", "Pre-COVID")
  )

# Calculate COVID impact
covid_impact_analysis <- retail_comparison %>%
  select(industry_type, period, employment_rate, unemployment_rate, covid_impact_rate) %>%
  pivot_longer(cols = c(employment_rate, unemployment_rate, covid_impact_rate), 
               names_to = "metric", values_to = "rate") %>%
  pivot_wider(names_from = period, values_from = rate) %>%
  mutate(
    covid_change = `Post-COVID` - `Pre-COVID`,
    pct_change = (covid_change / `Pre-COVID`) * 100
  )

covid_impact_analysis %>%
  filter(metric %in% c("employment_rate", "unemployment_rate")) %>%
  kable(digits = 2, 
        caption = "COVID Impact: Pre vs Post Comparison",
        col.names = c("Industry", "Metric", "Pre-COVID", "Post-COVID", 
                      "Change (pp)", "% Change")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
```

## Key Findings - Retail vs Non-Retail

**Employment Rate Changes:**
- **Retail**: 94.3% → 90.6% (-3.7 percentage points, -3.97% change)
- **Non-Retail**: 96.2% → 94.0% (-2.2 percentage points, -2.25% change)

**Unemployment Rate Changes:**
- **Retail**: 5.7% → 9.4% (+3.7 percentage points, +65.6% increase)
- **Non-Retail**: 3.9% → 6.0% (+2.2 percentage points, +56.4% increase)

**Retail workers experienced 1.7x larger employment rate declines than non-retail workers.**

# Research Question 3: COVID-Specific Work Impact Patterns

```{r covid-impact-patterns}
#| label: covid-impact-patterns
#| include: true

# COVID-specific impacts
covid_summary <- analysis_data %>%
  filter(!is.na(covid_work_impact)) %>%
  group_by(retail_industry) %>%
  summarise(
    covid_remote_pct = weighted.mean(covid_remote, WTFINL, na.rm = TRUE) * 100,
    covid_unable_pct = weighted.mean(covid_unable, WTFINL, na.rm = TRUE) * 100,
    total_covid_impact = weighted.mean(covid_work_impact, WTFINL, na.rm = TRUE) * 100,
    .groups = "drop"
  ) %>%
  mutate(industry_type = ifelse(retail_industry == 1, "Retail", "Non-Retail"))

covid_summary %>%
  select(industry_type, covid_remote_pct, covid_unable_pct, total_covid_impact) %>%
  kable(digits = 1, 
        caption = "COVID Work Impact Patterns by Industry",
        col.names = c("Industry", "Remote Work (%)", "Unable to Work (%)", "Total Impact (%)")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
```

## Key Findings - COVID Work Impact

**Non-Retail Workers:**
- 24.5% total COVID work impact (19.4% remote work, 6.4% unable to work)

**Retail Workers:**
- 13.2% total COVID work impact (5.6% remote work, 8.4% unable to work)

**Critical Insight**: Retail workers had lower overall COVID work impacts but were more likely to be unable to work rather than work remotely, reflecting the in-person nature of retail work and limited flexibility for pandemic adaptation.

# Regression Analysis

```{r regression-models}
#| label: regression-models
#| include: true

# Model 1: Employment probability
model1 <- feols(
  employed ~ retail_industry * post_covid + female + age_group + race_group + education,
  data = analysis_data,
  weights = ~WTFINL,
  vcov = "hetero"
)

# Model 2: COVID work impact
covid_data <- analysis_data %>% filter(!is.na(covid_work_impact))
model2 <- feols(
  covid_work_impact ~ retail_industry + female + age_group + race_group + education,
  data = covid_data,
  weights = ~WTFINL,
  vcov = "hetero"
)

# Model 3: Hours worked (for employed workers)
hours_data <- analysis_data %>% filter(employed == 1, !is.na(actual_hours))
model3 <- feols(
  actual_hours ~ retail_industry * post_covid + female + age_group + race_group + education,
  data = hours_data,
  weights = ~WTFINL,
  vcov = "hetero"
)

# Display regression results
models_list <- list(
  "Employment" = model1,
  "COVID Impact" = model2,
  "Hours Worked" = model3
)

modelsummary(
  models_list,
  title = "COVID Impact on Retail Employment: Regression Results",
  notes = c(
    "Standard errors are heteroskedasticity-robust.",
    "All models use CPS final weights (WTFINL).",
    "Sample: 2020-2022 CPS data, working-age population (16+).",
    "*** p<0.001, ** p<0.01, * p<0.05"
  ),
  stars = TRUE,
  fmt = 3
)
```

## Detailed Regression Results

```{r detailed-results}
#| label: detailed-results
#| include: true

# Display individual model summaries
cat("=== MODEL 1: EMPLOYMENT PROBABILITY ===\n")
summary(model1)

cat("\n=== MODEL 2: COVID WORK IMPACT ===\n")
summary(model2)

cat("\n=== MODEL 3: HOURS WORKED ===\n")
summary(model3)
```

## Regression Results Interpretation

### Model 1: Employment Probability (N = 1,443,532, Adj. R² = 0.0176)

**Key Coefficients:**
- **Intercept**: 0.9233*** (0.0015), t = 614.52, p < 2e-16
- **Retail Industry**: 0.0017 (0.0018), t = 0.94, p = 0.349 (no baseline difference)
- **Post-COVID**: -0.0219*** (0.0007), t = -33.28, p < 2e-16
- **Retail × Post-COVID**: -0.0153*** (0.0020), t = -7.84, p = 4.48e-15
- **Female**: -0.0014** (0.0005), t = -2.92, p = 0.003

**Age Effects (relative to 16-24):**
- Age 25-34: +3.59pp*** (t = 31.82)
- Age 35-44: +5.01pp*** (t = 45.88)
- Age 45-54: +5.31pp*** (t = 48.90)
- Age 55-64: +5.15pp*** (t = 47.17)
- Age 65+: +4.56pp*** (t = 36.57)

**Race Effects (relative to Asian/PI):**
- White: +1.55pp*** (t = 16.24)
- Black: -1.96pp*** (t = -15.22)
- Multiracial: -1.02pp*** (t = -4.34)
- Other: -1.37pp*** (t = -4.50)

**Education Effects (relative to Bachelor's):**
- Graduate Degree: +1.22pp*** (t = 20.55)
- HS or Less: -5.31pp*** (t = -43.77)
- Some College/Associates: -2.30pp*** (t = -41.57)

**INTERPRETATION**: The retail × post-COVID interaction coefficient of -0.0153 indicates that retail workers experienced an additional 1.53 percentage point decline in employment probability beyond the general COVID effect.

### Model 2: COVID Work Impact (N = 1,226,413, Adj. R² = 0.0750)

**Key Coefficients:**
- **Intercept**: 0.3588*** (0.0024), t = 150.50, p < 2e-16
- **Retail Industry**: -0.0547*** (0.0011), t = -52.08, p < 2e-16
- **Female**: 0.0234*** (0.0009), t = 27.30, p < 2e-16

**Age Effects (relative to 16-24):**
- Age 25-34: +4.75pp*** (t = 32.54)
- Age 35-44: +4.68pp*** (t = 32.10)
- Age 45-54: +3.58pp*** (t = 24.34)
- Age 55-64: +2.99pp*** (t = 20.15)
- Age 65+: +1.14pp*** (t = 6.13)

**Race Effects (relative to Asian/PI):**
- White: -8.69pp*** (t = -45.47)
- Black: -8.91pp*** (t = -39.18)
- Multiracial: -4.32pp*** (t = -11.21)
- Other: -7.95pp*** (t = -17.65)

**Education Effects (relative to Bachelor's):**
- Graduate Degree: +7.77pp*** (t = 47.27)
- HS or Less: -19.24pp*** (t = -121.13)
- Some College/Associates: -16.10pp*** (t = -143.78)

**INTERPRETATION**: Retail workers were 5.47 percentage points less likely to experience COVID work impacts, primarily due to lower remote work capability.

### Model 3: Hours Worked (N = 1,304,607, Adj. R² = 0.0951)

**Key Coefficients:**
- **Intercept**: 35.18*** (0.072), t = 485.89, p < 2e-16
- **Retail Industry**: -2.558*** (0.096), t = -26.66, p < 2e-16
- **Post-COVID**: -0.117** (0.040), t = -2.95, p = 0.003
- **Retail × Post-COVID**: 0.342*** (0.102), t = 3.37, p = 7.65e-04
- **Female**: -4.109*** (0.024), t = -170.76, p < 2e-16

**Age Effects (relative to 16-24):**
- Age 25-34: +6.29 hours*** (t = 133.99)
- Age 35-44: +6.93 hours*** (t = 146.38)
- Age 45-54: +7.51 hours*** (t = 157.21)
- Age 55-64: +6.35 hours*** (t = 129.53)
- Age 65+: +0.45 hours*** (t = 6.72)

**Race Effects (relative to Asian/PI):**
- White: +0.83 hours*** (t = 18.35)
- Black: +1.14 hours*** (t = 19.70)
- Multiracial: +0.38 hours*** (t = 3.52)
- Other: +0.85 hours*** (t = 6.60)

**Education Effects (relative to Bachelor's):**
- Graduate Degree: +0.74 hours*** (t = 18.93)
- HS or Less: -4.64 hours*** (t = -88.08)
- Some College/Associates: -0.83 hours*** (t = -28.79)

**INTERPRETATION**: Retail workers averaged 2.6 fewer hours per week than other industries. The positive interaction term suggests retail workers' hours recovered slightly better than expected post-COVID.

# Visualizations

```{r visualization-setup}
#| label: visualization-setup
#| include: false

# Load required libraries for visualizations
library(ggplot2)
library(scales)
library(viridis)
```

## Employment Rate Trends by Industry

```{r employment-trends}
#| label: employment-trends
#| include: true
#| fig-width: 10
#| fig-height: 6

# VISUALIZATION 1: Employment Rate Trends
employment_trends <- analysis_data %>%
  group_by(date, retail_industry) %>%
  summarise(
    employment_rate = weighted.mean(employed, WTFINL, na.rm = TRUE) * 100,
    unemployment_rate = weighted.mean(unemployed, WTFINL, na.rm = TRUE) * 100,
    .groups = "drop"
  ) %>%
  mutate(
    industry_type = ifelse(retail_industry == 1, "Retail", "Non-Retail")
  )

plot1_employment <- ggplot(employment_trends, aes(x = date, y = employment_rate, 
                                                  color = industry_type, linetype = industry_type)) +
  geom_line(linewidth = 1.2) +
  geom_vline(xintercept = as.Date("2020-04-01"), linetype = "dashed", alpha = 0.7, color = "red") +
  annotate("text", x = as.Date("2020-04-01"), y = 98, label = "COVID Start", 
           hjust = -0.1, color = "red", size = 3) +
  scale_x_date(date_labels = "%b %Y", date_breaks = "3 months") +
  scale_y_continuous(limits = c(80, 100), labels = percent_format(scale = 1)) +
  scale_color_manual(values = c("Retail" = "#d62728", "Non-Retail" = "#1f77b4")) +
  labs(
    title = "Employment Rate Trends: Retail vs Non-Retail Industries",
    subtitle = "Retail workers experienced steeper employment declines during COVID-19",
    x = "Date",
    y = "Employment Rate (%)",
    color = "Industry",
    linetype = "Industry",
    caption = "Source: IPUMS CPS 2020-2022, weighted estimates"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 11, color = "gray40")
  )

print(plot1_employment)
```

## COVID Work Impact Patterns

```{r covid-impact}
#| label: covid-impact
#| include: true
#| fig-width: 8
#| fig-height: 6

# VISUALIZATION 2: COVID Work Impact by Industry
covid_impact_data <- analysis_data %>%
  filter(!is.na(covid_work_impact)) %>%
  group_by(retail_industry) %>%
  summarise(
    remote_work = weighted.mean(covid_remote, WTFINL, na.rm = TRUE) * 100,
    unable_work = weighted.mean(covid_unable, WTFINL, na.rm = TRUE) * 100,
    total_impact = weighted.mean(covid_work_impact, WTFINL, na.rm = TRUE) * 100,
    .groups = "drop"
  ) %>%
  mutate(
    industry_type = ifelse(retail_industry == 1, "Retail", "Non-Retail")
  ) %>%
  pivot_longer(cols = c(remote_work, unable_work), 
               names_to = "impact_type", values_to = "percentage") %>%
  mutate(
    impact_type = case_when(
      impact_type == "remote_work" ~ "Worked Remotely",
      impact_type == "unable_work" ~ "Unable to Work"
    )
  )

plot2_covid_impact <- ggplot(covid_impact_data, aes(x = industry_type, y = percentage, 
                                                    fill = impact_type)) +
  geom_col(position = "dodge", width = 0.7, alpha = 0.8) +
  geom_text(aes(label = paste0(round(percentage, 1), "%")), 
            position = position_dodge(width = 0.7), vjust = -0.3, size = 3.5) +
  scale_fill_manual(values = c("Worked Remotely" = "#2ca02c", "Unable to Work" = "#ff7f0e")) +
  scale_y_continuous(limits = c(0, 25), labels = percent_format(scale = 1)) +
  labs(
    title = "COVID-19 Work Impact Patterns by Industry",
    subtitle = "Retail workers less likely to work remotely, more likely unable to work",
    x = "Industry Type",
    y = "Percentage of Workers Affected (%)",
    fill = "COVID Impact Type",
    caption = "Source: IPUMS CPS 2020-2022, weighted estimates"
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 11, color = "gray40")
  )

print(plot2_covid_impact)
```

## Industry Recovery Timeline

```{r recovery-timeline}
#| label: recovery-timeline
#| include: true
#| fig-width: 10
#| fig-height: 6

# VISUALIZATION 3: Industry Recovery Timeline
recovery_timeline <- analysis_data %>%
  filter(industry_group %in% c("Retail Trade", "Professional Services", "Manufacturing", "Construction")) %>%
  group_by(industry_group, date) %>%
  summarise(
    employment_rate = weighted.mean(employed, WTFINL, na.rm = TRUE) * 100,
    .groups = "drop"
  )

plot3_recovery <- ggplot(recovery_timeline, aes(x = date, y = employment_rate, 
                                                color = industry_group)) +
  geom_line(linewidth = 1.1, alpha = 0.8) +
  geom_vline(xintercept = as.Date("2020-04-01"), linetype = "dashed", alpha = 0.7, color = "red") +
  scale_x_date(date_labels = "%b %Y", date_breaks = "4 months") +
  scale_y_continuous(limits = c(80, 100), labels = percent_format(scale = 1)) +
  scale_color_viridis_d(option = "plasma", end = 0.8) +
  labs(
    title = "Employment Recovery by Major Industry",
    subtitle = "Retail Trade showed the slowest employment recovery",
    x = "Date",
    y = "Employment Rate (%)",
    color = "Industry",
    caption = "Source: IPUMS CPS 2020-2022, weighted estimates"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 11, color = "gray40")
  )

print(plot3_recovery)
```

# Statistical Validation Tests

```{r statistical-validation}
#| label: statistical-validation
#| include: true

# Load statistical validation tests
source("statistical_validation_tests.R")
```

## Comprehensive Statistical Testing Results

### 1. Model Significance Tests
All models show extremely high significance:
- **Model 1 (Employment)**: 16/17 coefficients significant (F >> 100)
- **Model 2 (COVID Impact)**: 15/15 coefficients significant (F >> 100)
- **Model 3 (Hours Worked)**: 17/17 coefficients significant (F >> 100)

### 2. Key Coefficient Hypothesis Tests (H₀: coefficient = 0)
- **Post-COVID Effect**: t = -33.28, p < 2e-16 ✓ **REJECT H₀**
- **Retail COVID Impact**: t = -52.08, p < 2e-16 ✓ **REJECT H₀**
- **Retail × Post-COVID Interaction**: t = -7.84, p = 4.48e-15 ✓ **REJECT H₀**

### 3. ANOVA for Group Differences
**Employment Rate ANOVA**: F = 1,699.55, p < 2e-16 ✓ **STRONG GROUP DIFFERENCES**

### 4. Difference-in-Differences Analysis
- **Retail Employment Change**: -3.74pp
- **Non-Retail Employment Change**: -2.17pp
- **Difference-in-Differences Effect**: -1.57pp (retail hit 1.57pp harder)

### 5. Welch's t-test for Unequal Variances
**Post-COVID Employment Rate Differences**:
- t = -46.462, df = 263,868.7, p < 2e-16
- 95% CI: [-3.15%, -2.90%] ✓ **RETAIL ≠ NON-RETAIL**

### 6. Joint Hypothesis Tests
- **Demographics**: 6/6 demographic variables significant (p < 0.05)
- All individual demographic coefficients significant (p < 0.001)

### 7. Heteroskedasticity Validation
- All models use heteroskedasticity-robust standard errors (vcov = 'hetero')
- Accounts for potential non-constant variance in survey data

### 8. Null Hypothesis Rejections Summary (α = 0.05)
✓ **Overall Model 1 Significance**: REJECTED  
✓ **Overall Model 2 Significance**: REJECTED  
✓ **Overall Model 3 Significance**: REJECTED  
✓ **Post-COVID Effect ≠ 0**: REJECTED  
✓ **Retail COVID Impact ≠ 0**: REJECTED  
✓ **Employment Rate Differences**: REJECTED  
✓ **Retail vs Non-Retail (Post-COVID)**: REJECTED  
✓ **Joint Demographics Effect**: REJECTED  

**All major hypotheses REJECTED at α = 0.05, providing strong statistical evidence.**

# Policy Implications and Conclusions

## Policy Recommendations

1. **Targeted Industry Support**: Retail workers experienced disproportionate employment losses (-3.7pp vs -2.2pp) and slower recovery, with statistically significant difference-in-differences effect of -1.57pp, supporting need for industry-specific programs.

2. **Work Flexibility Investment**: The low remote work capability in retail (5.6% vs 19.4% other industries) highlights structural challenges for pandemic adaptation and need for alternative flexibility measures.

3. **Demographic-Targeted Interventions**: Women and certain age groups showed higher COVID work impact rates, with all demographic effects statistically significant, requiring focused policy attention.

4. **Address Underemployment**: Retail workers' 2.6 fewer average hours suggest underemployment issues beyond unemployment statistics.

5. **Recovery Monitoring**: Retail employment recovering but interaction effects show persistent challenges requiring continued monitoring.

## Methodological Strengths

- **Large, representative sample**: 1.44 million observations with proper CPS survey weights
- **Official data positions**: IPUMS codebook ensures accurate variable extraction from fixed-width data
- **Direct COVID measurement**: COVIDTELEW and COVIDUNAW variables provide precise impact assessment
- **Comprehensive demographic controls**: All effects statistically validated
- **Robust statistical methods**: Heteroskedasticity-robust standard errors account for survey data complexity
- **Multiple model specifications**: Three complementary models for robustness
- **Extensive statistical validation**: F-tests, t-tests, ANOVA, DiD, and Welch's tests
- **All null hypotheses rejected**: At conventional significance levels (α = 0.05)

## Limitations

- COVID-specific variables limited to certain survey months
- Cross-sectional analysis limits causal inference despite DiD approach
- Industry classification based on 1990 codes for consistency across time
- Some income variables only available in ASEC supplements
- Fixed-width data extraction requires precise column positioning

## Conclusion

This analysis provides robust statistical evidence that **COVID-19 disproportionately affected retail employment**, with larger job losses (-3.7pp vs -2.2pp), slower recovery, and distinct patterns of work disruption compared to other industries. The difference-in-differences effect of -1.57 percentage points is both statistically significant (p < 0.001) and economically meaningful.

**Comprehensive statistical validation** through F-tests, t-tests, ANOVA, difference-in-differences analysis, and Welch's t-tests confirms the robustness of all key findings. All major null hypotheses are rejected at α = 0.05, providing strong evidence for differential COVID impacts on retail employment.

The findings support targeted policy interventions for retail workers and highlight the importance of work flexibility in pandemic resilience. Results demonstrate the value of using official IPUMS codebook positions and proper survey weights for accurate analysis of labor market dynamics during economic crises.

**Analysis completed using IPUMS CPS 2020-2022 data with official codebook variable positions, proper survey weighting methodology, and comprehensive statistical validation.**


